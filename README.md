
# SFML 렌더링 알고리즘 및 OpenMP 병렬 처리 최적화

이 프로젝트는 SFML을 이용한 3D 렌더링을 구현, 여러 obj로 이루어진 연속 이미지를 순차적으로 렌더링하며, OpenMP 기반의 병렬 처리 최적화를 적용하였습니다. 이 코드는 실시간 렌더링, 메시 변환, 클리핑, 래스터라이징 등을 수행하며, 병렬 처리의 경우, 클리핑 단계에서 활용되었습니다. SFML 특성상 내부에서의 멀티스레드 지원을 하지 않아 엔진 바깥에서의 수학 계산을 최적화하였습니다.

## 작업 기간
- 2023/04/03 ~ 2023/04/20
## 작업자
- **최정용** : 렌더링 알고리즘 구축, OpenMP 알고리즘 구조화
- **백민수** : OpenMP 알고리즘 구조화 및 렌더링 알고리즘 개선
- **이인권** : 자료 조사 및 코드 최적화 작업CUDA 기반 평활화 커널 구조화, OpenMP CPU 코드 최적화 진행
	 
	 


## 주요 기능

- **연속된 .obj파일의 메시 처리:**  
  - OBJ 파일로부터 3D 객체를 로드해, 정점(`vec3`), 삼각형(`tri3`), 메시(`mesh`) 등 사용자 정의 자료구조를 사용해 메시 처리를 합니다.
  - 4x4 행렬(쿼터니언)을 이용한 3D 변환(회전(X, Y, Z), 이동, 원근 투영)을 구현합니다.  
  - 카메라의 위치와 방향에 따른 뷰 및 월드 변환을 지원합니다.

- **래스터라이제이션 파이프라인:**  
  - 3D 좌표를 2D 화면 공간으로 투영합니다.  
  - 깊이 값을 기준으로 삼각형을 정렬하여 올바른 가림과 겹침 처리를 수행합니다.  
  - 와이어프레임 모드와 채워진 삼각형 렌더링 옵션을 제공합니다.

![Image](https://github.com/user-attachments/assets/78c503cc-35f6-4600-8f2f-6fbb30516c08)
- **OpenMP를 이용한 병렬 처리:**  
  - **병렬 클리핑:** 삼각형 클리핑 과정을 4개의 스레드로 나누어 병렬 처리합니다.  
    - 각 스레드는 특정 화면 경계(상단, 하단, 좌측, 우측)에 대해 클리핑을 담당합니다.  
    - 중간 결과는 스레드별 리스트에 저장된 후 최종적으로 병합됩니다.
  - **효율성:** 병렬 처리를 통해 각 프레임의 처리 시간을 단축하여 복잡한 장면에서도 부드러운 애니메이션과 높은 프레임 속도를 유지할 수 있습니다.

## 성능
![Image](https://github.com/user-attachments/assets/2bfd4642-7dff-4fde-8708-b66f89bac670)



## 코드 구조

- **RenderSettings:**  
  설정 옵션(해상도, 시야각(FOV), 워터마크, 와이어프레임 모드 등)을 포함하는 구조체입니다.

- **벡터 및 행렬 연산:**  
  - `vec3`: 3D 벡터  
  - `tri3`: 정점 위치와 색상 정보를 담은 삼각형 데이터  
  - `mat4`: 4x4 변환 행렬  
  - 벡터 산술 연산, 정규화, 내적 및 외적 함수들을 포함합니다.  
  - 단위 행렬, 회전, 이동, 투영 행렬 생성 함수들을 구현합니다.

- **메시 로딩 및 변환:**  
  - `mesh` 구조체는 OBJ 파일을 로드하여 삼각형 벡터를 저장합니다.  
  - `DrawMesh` 함수는 3D 메시를 2D 삼각형으로 변환하고 투영합니다.

- **이벤트 처리 및 렌더링 루프:**  
  - `main` 함수에서는 창 이벤트 처리, 카메라 이동, 그리고 장면 업데이트를 지속적으로 수행합니다.  
  - 메시의 동적 로딩 및 애니메이션은 OBJ 파일의 시퀀스를 순환하며 구현됩니다.

- **래스터라이제이션 및 클리핑:**  
  - **`RasterRenderMesh` 함수:**  
    - 투영된 삼각형 리스트를 처리합니다.  
    - OpenMP를 이용해 4개의 스레드로 삼각형 클리핑을 병렬 처리합니다.  
    - 각 스레드는 자신만의 리스트를 사용하여 스레드 안전하게 클리핑 작업을 수행한 후, 결과를 병합합니다.  
    - 최종적으로 클리핑된 삼각형은 `DrawTriangle` 함수를 통해 화면에 출력됩니다.

---

## OpenMP 병렬 처리 상세 설명

병렬 처리는 `RasterRenderMesh` 함수 내의 삼각형 클리핑 단계에 집중되어 있습니다.

- **스레드 분할:**  
  OpenMP 디렉티브를 사용하여 4개의 스레드를 생성합니다.
  ```cpp
  #pragma omp parallel num_threads(4)
